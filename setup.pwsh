#!/bin/pwsh

# vars
$msfdb = "/usr/share/metasploit-framework/config/database.yml"
$uname = "will"

# --------------  Updates & prep   -_------------------
write-host "[+] staging updates" -foregroundcolor green
$sb = {sudo apt-get update -y & apt-get upgrade -y} 
invoke-command -ScriptBlock $sb | out-null

# --------------  configure msfdb  --------------------
write-host "[+] staging bambi's msfdb" -foregroundcolor green

# get password and convert to b64
$pw = read-host "Whats the az hosted postgresql password?"
$EncodedPw =[Convert]::ToBase64String([System.Text.Encoding]::UTF8.GetBytes($pw))
write-host "-[*] base64 password is: $EncodedPw" -foregroundcolor darkgreen
# copy item to correct location
write-host "[+] configuring msfdb config" -foregroundcolor green
copy-item database.yml -destination $msfdb -force 

# add password to msfdb
(Get-Content database.yml) | Foreach-Object {$_ -replace 'REPLACEMEEE',"$EncodedPw"}  | Out-File $msfdb 

# -------------- import msfmodules --------------------
# auxillary

# exploits

# payloads

# encoders

# evasion

# nops

# post

# --------------       htb      -----------------------
write-host "[+] copying VPN configuration files: /home/$uname/htb/vpn" -foregroundcolor green
if(!(test-path /home/$uname/htb/vpn))
{
    new-item /home/will/htb/vpn/ -ItemType Directory -force | out-null
}
copy-item *.ovpn -Destination "/home/$uname/htb/vpn/" -recurse | out-null

